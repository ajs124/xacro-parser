{"version":3,"file":"XacroLoader.js","sources":["../src/utils.js","../src/XacroLoader.js"],"sourcesContent":["\r\nexport function getUrlBase(url) {\r\n    const tokens = url.split(/[\\\\/]/g);\r\n    tokens.pop();\r\n    if (tokens.length === 0) {\r\n        return './';\r\n    } else {\r\n        return tokens.join('/') + '/';\r\n    }\r\n}\r\n\r\n// XML Helpers\r\n// QuerySelectorAll that respects tag prefixes like 'xacro:'\r\nexport function getElementsWithName(node, name, res = []) {\r\n    if (node.tagName === name) {\r\n        res.push(node);\r\n    }\r\n    for (let i = 0, l = node.children.length; i < l; i++) {\r\n        const child = node.children[i];\r\n        getElementsWithName(child, name, res);\r\n    }\r\n    return res;\r\n}\r\n\r\n// Deep clone an xml node without the macro or property tags.\r\nexport function deepClone(node, stripPropsMacros) {\r\n    const cloned = node.cloneNode();\r\n    const childNodes = node.childNodes;\r\n    for (let i = 0, l = childNodes.length; i < l; i++) {\r\n        const child = childNodes[i];\r\n        const tagName = child.tagName;\r\n        if (!stripPropsMacros || (tagName !== 'xacro:property' && tagName !== 'xacro:macro')) {\r\n            cloned.appendChild(deepClone(child, stripPropsMacros));\r\n        }\r\n    }\r\n    return cloned;\r\n}\r\n\r\n// Takes an array of xml elements and removes the last elements that\r\n// are comments or newlines.\r\nexport function removeEndCommentsFromArray(arr) {\r\n    while (arr.length > 0) {\r\n        const el = arr[arr.length - 1];\r\n        if (el.nodeType !== el.ELEMENT_NODE) {\r\n            arr.pop();\r\n        } else {\r\n            break;\r\n        }\r\n    }\r\n}\r\n\r\n// Expression helpers\r\nexport function isOperator(str) {\r\n    const regexp = /^[()/*+\\-%|&=[\\]]+$/;\r\n    return regexp.test(str);\r\n}\r\n\r\nexport function isString(str) {\r\n    const regexp = /^(('[^']*?')|(\"[^\"]*?\")|(`[^`]*?`))$/;\r\n    return regexp.test(str);\r\n}\r\n\r\n// TODO: make this more robust\r\nexport function isNumber(str) {\r\n    return !isNaN(parseFloat(str)) && !/[^0-9.eE-]/.test(str);\r\n}\r\n\r\n// TODO: this needs to tokenize numbers together\r\nexport function tokenize(str) {\r\n    const regexp = /(('[^']*?')|(\"[^\"]*?\")|(`[^`]*?`)|([()/*+\\-%|&=[\\]]+))/g;\r\n    return str\r\n        .replace(regexp, m => ` ${ m } `)\r\n        .trim()\r\n        .split(/\\s+/g);\r\n}\r\n\r\nexport function normalizeExpression(str) {\r\n    // Remove any instances of \"--\" or \"++\" that might occur from negating a negative number\r\n    // by adding a space that are not in a string.\r\n    return str.replace(/[-+]{2,}/, val => {\r\n        let positive = true;\r\n        for (let i = 0, l = val.length; i < l; i++) {\r\n            const operator = val[i];\r\n            if (operator === '-') {\r\n                positive = !positive;\r\n            }\r\n        }\r\n\r\n        return positive ? '+' : '-';\r\n    });\r\n}\r\n\r\n// Property Set Helpers\r\nexport const PARENT_SCOPE = Symbol('parent');\r\n\r\n// merges a set of properties together into a single set retaining\r\n// the parent scope link as well.\r\nexport function mergePropertySets(...args) {\r\n    const res = {};\r\n    for (let i = 0, l = args.length; i < l; i++) {\r\n        const obj = args[i];\r\n        for (const key in obj) {\r\n            res[key] = obj[key];\r\n        }\r\n        if (PARENT_SCOPE in obj) {\r\n            res[PARENT_SCOPE] = obj[PARENT_SCOPE];\r\n        }\r\n    }\r\n    return res;\r\n}\r\n\r\n// Copies a property set and creates a link to the original set as a parent scope\r\nexport function createNewPropertyScope(properties) {\r\n    const res = mergePropertySets(properties);\r\n    res[PARENT_SCOPE] = properties;\r\n    return res;\r\n}\r\n","import { getUrlBase } from './utils.js';\r\nimport { XacroParser } from './XacroParser.js';\r\n\r\nexport default\r\nclass XacroLoader extends XacroParser {\r\n\r\n    constructor() {\r\n\r\n        super();\r\n        this.fetchOptions = {};\r\n\r\n    }\r\n\r\n    load(url, onComplete, onError) {\r\n\r\n        const workingPath = getUrlBase(url);\r\n        if (this.workingPath === '') {\r\n\r\n            this.workingPath = workingPath;\r\n\r\n        }\r\n\r\n        this\r\n            .getFileContents(url)\r\n            .then(text => {\r\n\r\n                this.parse(text, onComplete, onError);\r\n\r\n            })\r\n            .catch(e => {\r\n\r\n                if (onError) {\r\n\r\n                    onError(e);\r\n\r\n                }\r\n\r\n            });\r\n\r\n    }\r\n\r\n    parse(data, onComplete, onError) {\r\n\r\n        super\r\n            .parse(data)\r\n            .then(onComplete)\r\n            .catch(e => {\r\n\r\n                if (onError) {\r\n\r\n                    onError(e);\r\n\r\n                }\r\n\r\n            });\r\n\r\n    }\r\n\r\n    getFileContents(path) {\r\n\r\n        return fetch(path, this.fetchOptions).then(res => res.text());\r\n\r\n    }\r\n\r\n}\r\n"],"names":["XacroParser"],"mappings":"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"}